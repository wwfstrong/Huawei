{"version":3,"sources":["src/javascript/swiper.js","src/javascript/index.js"],"names":["Swiper","node","Error","root","initX","newX","clock","document","querySelector","eventHub","swipLeft","swipRight","ontouchstart","e","changedTouches","pageX","ontouchmove","clearTimeout","setTimeout","forEach","fn","bind","on","type","push","off","index","indexOf","splice","Player","$","selector","$$","querySelectorAll","songList","currentIndex","audio","Audio","start","lyricsArr","lyricIndex","fetch","then","res","json","data","renderSong","self","onclick","classList","contains","pause","remove","add","play","currentTime","length","playSong","ontimeupdate","locateLyric","setProgerssBar","swiper","songObj","innerText","title","author","albumn","src","url","onloadedmetadata","formateTime","duration","loadLyric","oncanplaythrough","lyric","console","log","setLyrics","window","lyrics","setLyricToCenter","fragment","createDocumentFragment","split","filter","str","match","line","replace","t","milliseconds","parseInt","slice","trim","sort","v1","v2","createElement","setAttribute","appendChild","innerHTML","offset","offsetTop","style","transform","percent","width","secondsTotal","minutes","seconds","p"],"mappings":"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","file":"javascript.2d0cd357.js","sourceRoot":"..","sourcesContent":["/*\r\nlet Swiper = (function() {\r\n  let root = document;\r\n  let eventHub = { swipLeft: [], swipRight: [] };\r\n  function bind(node) {\r\n    root = node;\r\n  }\r\n  function on(type, fn) {\r\n    if (eventHub[type]) {\r\n      eventHub[type].push(fn);\r\n    }\r\n  }\r\n  var initX;\r\n  var newX;\r\n  var clock;\r\n  root.ontouchstart = function(e) {\r\n    initX = e.changedTouches[0].pageX;\r\n  };\r\n  root.ontouchmove = function(e) {\r\n    if (clock) clearTimeout(clock);\r\n    clock = setTimeout(() => {\r\n      newX = e.changedTouches[0].pageX;\r\n      if (newX - initx > 0) {\r\n        eventHub[\"swipRight\"].forEach(fn => fn());\r\n      } else {\r\n        eventHub[\"swipLeft\"].forEach(fn => fn());\r\n      }\r\n    }, 100);\r\n  };\r\n  return {\r\n    bind: bind,\r\n    on: on\r\n  };\r\n})();\r\n\r\nSwiper.bind(document.querySelector(\"#box\"));\r\n\r\nSwiper.on(\"swipLeft\", function() {\r\n  console.log(\"swipLeft\");\r\n});\r\n\r\nSwiper.on(\"swipLeft\", function() {\r\n  console.log(\"swipLeft 111\");\r\n});\r\n\r\nSwiper.on(\"swipRight\", function() {\r\n  console.log(\"swipRight 111\");\r\n});\r\n\r\nSwiper.on(\"swipRight\", function() {\r\n  console.log(\"swipRight 222\");\r\n});\r\n*/\r\n\r\nclass Swiper {\r\n  constructor(node) {\r\n    if (!node) throw new Error(\"需要传递需要绑定的DOM元素\");\r\n    let root = typeof node === \"string\" ? document.querySelector(node) : node;\r\n    let eventHub = { swipLeft: [], swipRight: [] };\r\n\r\n    var initX;\r\n    var newX;\r\n    var clock;\r\n    root.ontouchstart = function(e) {\r\n      initX = e.changedTouches[0].pageX;\r\n    };\r\n    root.ontouchmove = function(e) {\r\n      if (clock) clearTimeout(clock);\r\n      clock = setTimeout(() => {\r\n        newX = e.changedTouches[0].pageX;\r\n        if (newX - initX > 10) {\r\n          eventHub[\"swipRight\"].forEach(fn => fn.bind(root)());\r\n        } else if (newX - initX < 10) {\r\n          eventHub[\"swipLeft\"].forEach(fn => fn.bind(root)());\r\n        }\r\n      }, 100);\r\n    };\r\n\r\n    this.on = function(type, fn) {\r\n      if (eventHub[type]) {\r\n        eventHub[type].push(fn);\r\n      }\r\n    };\r\n\r\n    this.off = function(type, fn) {\r\n      let index = eventHub[type].indexOf(fn);\r\n      if (index !== -1) {\r\n        eventHub[type].splice(index, 1);\r\n      }\r\n    };\r\n  }\r\n}\r\nexport default Swiper;\r\n","import \"./swiper.js\";\r\nimport Swiper from \"./swiper.js\";\r\n\r\nclass Player {\r\n  constructor(node) {\r\n    this.root = typeof node === \"string\" ? document.querySelector(node) : node;\r\n    this.$ = selector => this.root.querySelector(selector);\r\n    this.$$ = selector => this.root.querySelectorAll(selector);\r\n    this.songList = [];\r\n    this.currentIndex = 0;\r\n    this.audio = new Audio();\r\n    this.start();\r\n    this.bind();\r\n    this.lyricsArr = [];\r\n    this.lyricIndex = -1;\r\n  }\r\n  start() {\r\n    fetch(\"https://wwfstrong.github.io/wwf-data/huawei/music-list.json\")\r\n      .then(res => res.json())\r\n      .then(data => {\r\n        this.songList = data;\r\n        this.renderSong();\r\n      });\r\n  }\r\n  bind() {\r\n    let self = this;\r\n    this.$(\".btn-play-pause\").onclick = function() {\r\n      if (this.classList.contains(\"playing\")) {\r\n        self.audio.pause();\r\n        this.classList.remove(\"playing\");\r\n        this.classList.add(\"pause\");\r\n      } else if (this.classList.contains(\"pause\")) {\r\n        self.audio.play();\r\n        this.classList.remove(\"pause\");\r\n        this.classList.add(\"playing\");\r\n      }\r\n    };\r\n    this.$(\".btn-loop\").onclick = function() {\r\n      self.audio.currentTime = 0;\r\n    };\r\n    this.$(\".btn-prev\").onclick = function() {\r\n      self.currentIndex =\r\n        (self.songList.length + self.currentIndex - 1) % self.songList.length;\r\n      self.renderSong();\r\n      self.playSong();\r\n    };\r\n\r\n    this.$(\".btn-next\").onclick = function() {\r\n      self.currentIndex = (self.currentIndex + 1) % self.songList.length;\r\n      self.renderSong();\r\n      self.playSong();\r\n    };\r\n\r\n    this.audio.ontimeupdate = function() {\r\n      self.locateLyric();\r\n      self.setProgerssBar();\r\n    };\r\n\r\n    let swiper = new Swiper(this.$(\".panels\"));\r\n    swiper.on(\"swipLeft\", function() {\r\n      this.classList.remove(\"panel1\");\r\n      this.classList.add(\"panel2\");\r\n      self.$(\".balls .sp-1\").classList.remove(\"current\");\r\n      self.$(\".balls .sp-2\").classList.add(\"current\");\r\n    });\r\n    swiper.on(\"swipRight\", function() {\r\n      this.classList.remove(\"panel2\");\r\n      this.classList.add(\"panel1\");\r\n      self.$(\".balls .sp-1\").classList.add(\"current\");\r\n      self.$(\".balls .sp-2\").classList.remove(\"current\");\r\n    });\r\n  }\r\n\r\n  renderSong() {\r\n    let songObj = this.songList[this.currentIndex];\r\n    this.$(\".header h1\").innerText = songObj.title;\r\n    this.$(\".header p\").innerText = songObj.author + \" - \" + songObj.albumn;\r\n    this.audio.src = songObj.url;\r\n    this.audio.onloadedmetadata = () =>\r\n      (this.$(\".time-end\").innerText = this.formateTime(this.audio.duration));\r\n    this.loadLyric();\r\n  }\r\n\r\n  playSong() {\r\n    this.$(\".btn-play-pause\").classList.remove(\"pause\");\r\n    this.$(\".btn-play-pause\").classList.add(\"playing\");\r\n    this.audio.oncanplaythrough = () => this.audio.play();\r\n  }\r\n\r\n  loadLyric() {\r\n    fetch(this.songList[this.currentIndex].lyric)\r\n      .then(res => res.json())\r\n      .then(data => {\r\n        console.log(data.lyric);\r\n        this.setLyrics(data.lyric);\r\n        window.lyrics = data.lyric;\r\n      });\r\n  }\r\n\r\n  locateLyric() {\r\n    let currentTime = this.audio.currentTime * 1000;\r\n    let nextLineTime = this.lyricsArr[this.lyricIndex + 1][0];\r\n    if (\r\n      currentTime > nextLineTime &&\r\n      this.lyricIndex < this.lyricsArr.length - 1\r\n    ) {\r\n      this.lyricIndex++;\r\n      let node = this.$(\r\n        '[data-time=\"' + this.lyricsArr[this.lyricIndex][0] + '\"]'\r\n      );\r\n      if (node) this.setLyricToCenter(node);\r\n      this.$$(\".panel-effect .lyric p\")[0].innerText = this.lyricsArr[\r\n        this.lyricIndex\r\n      ][1];\r\n      this.$$(\".panel-effect .lyric p\")[1].innerText = this.lyricsArr[\r\n        this.lyricIndex + 1\r\n      ]\r\n        ? this.lyricsArr[this.lyricIndex + 1][1]\r\n        : \"\";\r\n    }\r\n  }\r\n\r\n  setLyrics(lyrics) {\r\n    this.lyricIndex = 0;\r\n    let fragment = document.createDocumentFragment();\r\n    let lyricsArr = [];\r\n    this.lyricsArr = lyricsArr;\r\n    lyrics\r\n      .split(/\\n/)\r\n      .filter(str => str.match(/\\[.+?\\]/))\r\n      .forEach(line => {\r\n        let str = line.replace(/\\[.+?\\]/g, \"\");\r\n        line.match(/\\[.+?\\]/g).forEach(t => {\r\n          t = t.replace(/[\\[\\]]/g, \"\");\r\n          let milliseconds =\r\n            parseInt(t.slice(0, 2)) * 60 * 1000 +\r\n            parseInt(t.slice(3, 5)) * 1000 +\r\n            parseInt(t.slice(6));\r\n          lyricsArr.push([milliseconds, str]);\r\n        });\r\n      });\r\n\r\n    lyricsArr\r\n      .filter(line => line[1].trim() !== \"\")\r\n      .sort((v1, v2) => {\r\n        if (v1[0] > v2[0]) {\r\n          return 1;\r\n        } else {\r\n          return -1;\r\n        }\r\n      })\r\n      .forEach(line => {\r\n        let node = document.createElement(\"p\");\r\n        node.setAttribute(\"data-time\", line[0]);\r\n        node.innerText = line[1];\r\n        fragment.appendChild(node);\r\n      });\r\n    this.$(\".panel-lyrics .container\").innerHTML = \"\";\r\n    this.$(\".panel-lyrics .container\").appendChild(fragment);\r\n  }\r\n\r\n  setLyricToCenter(node) {\r\n    let offset = node.offsetTop;\r\n    this.$(\".panels .container\").style.transform = `translateY(-${offset}px)`;\r\n    this.$$(\".panels .container p\").forEach(node =>\r\n      node.classList.remove(\"current\")\r\n    );\r\n    node.classList.add(\"current\");\r\n  }\r\n\r\n  setProgerssBar() {\r\n    let percent = (this.audio.currentTime * 100) / this.audio.duration + \"%\";\r\n    this.$(\".bar .progress\").style.width = percent;\r\n    this.$(\".time-start\").innerText = this.formateTime(this.audio.currentTime);\r\n  }\r\n\r\n  formateTime(secondsTotal) {\r\n    let minutes = parseInt(secondsTotal / 60);\r\n    minutes = minutes >= 10 ? \"\" + minutes : \"0\" + minutes;\r\n    let seconds = parseInt(secondsTotal % 60);\r\n    seconds = seconds >= 10 ? \"\" + seconds : \"0\" + seconds;\r\n    return minutes + \":\" + seconds;\r\n  }\r\n}\r\n\r\nwindow.p = new Player(\"#player\");\r\n"]}